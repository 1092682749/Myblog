<mxfile host="app.diagrams.net" modified="2021-06-08T14:17:25.710Z" agent="5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36" etag="eoO3raL-hgShAO0s_3VV" version="14.7.6" type="github">
  <diagram id="mtetrAsdsVfbl5sYTp5w" name="Page-1">
    <mxGraphModel dx="1038" dy="633" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="fJW2ksR1hG_YBAA2tKQd-2" value="&lt;h1&gt;为什么要使用redis&lt;/h1&gt;&lt;p&gt;???????&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="20" y="10" width="330" height="70" as="geometry" />
        </mxCell>
        <mxCell id="fJW2ksR1hG_YBAA2tKQd-7" value="&lt;h1&gt;server.h-定义一些关键的结构体&lt;/h1&gt;&lt;div&gt;redisServer结构体：&lt;/div&gt;&lt;div&gt;&lt;ul style=&quot;box-sizing: border-box ; padding-left: 2em ; margin-top: 0px ; margin-bottom: 16px ; color: rgb(36 , 41 , 46) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;segoe ui&amp;#34; , &amp;#34;helvetica&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif , &amp;#34;apple color emoji&amp;#34; , &amp;#34;segoe ui emoji&amp;#34; ; font-size: 16px ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;li style=&quot;box-sizing: border-box&quot;&gt;&lt;code style=&quot;box-sizing: border-box ; font-family: , &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , monospace ; font-size: 13.6px ; padding: 0.2em 0.4em ; margin: 0px ; border-radius: 6px&quot;&gt;server.db&lt;/code&gt;&amp;nbsp;is an array of Redis databases, where data is stored.&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box ; margin-top: 0.25em&quot;&gt;&lt;code style=&quot;box-sizing: border-box ; font-family: , &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , monospace ; font-size: 13.6px ; padding: 0.2em 0.4em ; margin: 0px ; border-radius: 6px&quot;&gt;server.commands&lt;/code&gt;&amp;nbsp;is the command table.&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box ; margin-top: 0.25em&quot;&gt;&lt;code style=&quot;box-sizing: border-box ; font-family: , &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , monospace ; font-size: 13.6px ; padding: 0.2em 0.4em ; margin: 0px ; border-radius: 6px&quot;&gt;server.clients&lt;/code&gt;&amp;nbsp;is a linked list of clients connected to the server.&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box ; margin-top: 0.25em&quot;&gt;&lt;code style=&quot;box-sizing: border-box ; font-family: , &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , monospace ; font-size: 13.6px ; padding: 0.2em 0.4em ; margin: 0px ; border-radius: 6px&quot;&gt;server.master&lt;/code&gt;&amp;nbsp;is a special client, the master, if the instance is a replica.&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="20" y="80" width="590" height="170" as="geometry" />
        </mxCell>
        <mxCell id="fJW2ksR1hG_YBAA2tKQd-8" value="&lt;h1&gt;server.c-main方法&lt;/h1&gt;&lt;div&gt;重要的方法：&lt;/div&gt;&lt;div&gt;&lt;ul style=&quot;box-sizing: border-box ; padding-left: 2em ; margin-top: 0px ; margin-bottom: 16px ; color: rgb(36 , 41 , 46) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;segoe ui&amp;#34; , &amp;#34;helvetica&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif , &amp;#34;apple color emoji&amp;#34; , &amp;#34;segoe ui emoji&amp;#34; ; font-size: 16px ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;li style=&quot;box-sizing: border-box&quot;&gt;&lt;code style=&quot;box-sizing: border-box ; font-family: , &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , monospace ; font-size: 13.6px ; padding: 0.2em 0.4em ; margin: 0px ; border-radius: 6px&quot;&gt;initServerConfig()&lt;/code&gt;&amp;nbsp;sets up the default values of the&amp;nbsp;&lt;code style=&quot;box-sizing: border-box ; font-family: , &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , monospace ; font-size: 13.6px ; padding: 0.2em 0.4em ; margin: 0px ; border-radius: 6px&quot;&gt;server&lt;/code&gt;&amp;nbsp;structure.&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box ; margin-top: 0.25em&quot;&gt;&lt;code style=&quot;box-sizing: border-box ; font-family: , &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , monospace ; font-size: 13.6px ; padding: 0.2em 0.4em ; margin: 0px ; border-radius: 6px&quot;&gt;initServer()&lt;/code&gt;&amp;nbsp;allocates the data structures needed to operate, setup the listening socket, and so forth.&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box ; margin-top: 0.25em&quot;&gt;&lt;code style=&quot;box-sizing: border-box ; font-family: , &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , monospace ; font-size: 13.6px ; padding: 0.2em 0.4em ; margin: 0px ; border-radius: 6px&quot;&gt;aeMain()&lt;/code&gt;&amp;nbsp;starts the event loop which listens for new connections.&lt;/li&gt;&lt;/ul&gt;&lt;span style=&quot;background-color: rgb(255 , 255 , 255) ; color: rgb(36 , 41 , 46) ; font-size: 16px&quot;&gt;&amp;nbsp; There are two special functions called periodically by the event loop:&lt;/span&gt;&lt;ul style=&quot;box-sizing: border-box ; padding-left: 2em ; margin-top: 0px ; margin-bottom: 16px ; color: rgb(36 , 41 , 46) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;segoe ui&amp;#34; , &amp;#34;helvetica&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif , &amp;#34;apple color emoji&amp;#34; , &amp;#34;segoe ui emoji&amp;#34; ; font-size: 16px ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;li&gt;&lt;code style=&quot;box-sizing: border-box ; font-size: 13.6px ; padding: 0.2em 0.4em ; margin: 0px ; border-radius: 6px&quot;&gt;serverCron()&lt;/code&gt;&amp;nbsp;is called periodically (according to&amp;nbsp;&lt;code style=&quot;box-sizing: border-box ; font-size: 13.6px ; padding: 0.2em 0.4em ; margin: 0px ; border-radius: 6px&quot;&gt;server.hz&lt;/code&gt;&amp;nbsp;frequency), and performs tasks that must be performed from time to time, like checking for timed out clients.&lt;br&gt;&lt;/li&gt;&lt;li&gt;&lt;code style=&quot;box-sizing: border-box ; font-size: 13.6px ; padding: 0.2em 0.4em ; margin: 0px ; border-radius: 6px&quot;&gt;beforeSleep()&lt;/code&gt;&amp;nbsp;is called every time the event loop fired, Redis served a few requests, and is returning back into the event loop.&lt;br&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="20" y="290" width="770" height="260" as="geometry" />
        </mxCell>
        <mxCell id="fJW2ksR1hG_YBAA2tKQd-9" value="&lt;h1&gt;server.c-其他比较重要的方法定义&lt;/h1&gt;&lt;div&gt;&lt;ul style=&quot;box-sizing: border-box ; padding-left: 2em ; margin-top: 0px ; margin-bottom: 16px ; color: rgb(36 , 41 , 46) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;segoe ui&amp;#34; , &amp;#34;helvetica&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif , &amp;#34;apple color emoji&amp;#34; , &amp;#34;segoe ui emoji&amp;#34; ; font-size: 16px ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;li style=&quot;box-sizing: border-box&quot;&gt;&lt;code style=&quot;box-sizing: border-box ; font-family: , &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , monospace ; font-size: 13.6px ; padding: 0.2em 0.4em ; margin: 0px ; border-radius: 6px&quot;&gt;call()&lt;/code&gt;&amp;nbsp;is used in order to call a given command in the context of a given client.&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box ; margin-top: 0.25em&quot;&gt;&lt;code style=&quot;box-sizing: border-box ; font-family: , &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , monospace ; font-size: 13.6px ; padding: 0.2em 0.4em ; margin: 0px ; border-radius: 6px&quot;&gt;activeExpireCycle()&lt;/code&gt;&amp;nbsp;handles eviction of keys with a time to live set via the&amp;nbsp;&lt;code style=&quot;box-sizing: border-box ; font-family: , &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , monospace ; font-size: 13.6px ; padding: 0.2em 0.4em ; margin: 0px ; border-radius: 6px&quot;&gt;EXPIRE&lt;/code&gt;&amp;nbsp;command.&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box ; margin-top: 0.25em&quot;&gt;&lt;code style=&quot;box-sizing: border-box ; font-family: , &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , monospace ; font-size: 13.6px ; padding: 0.2em 0.4em ; margin: 0px ; border-radius: 6px&quot;&gt;performEvictions()&lt;/code&gt;&amp;nbsp;is called when a new write command should be performed but Redis is out of memory according to the&amp;nbsp;&lt;code style=&quot;box-sizing: border-box ; font-family: , &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , monospace ; font-size: 13.6px ; padding: 0.2em 0.4em ; margin: 0px ; border-radius: 6px&quot;&gt;maxmemory&lt;/code&gt;&amp;nbsp;directive.&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box ; margin-top: 0.25em&quot;&gt;The global variable&amp;nbsp;&lt;code style=&quot;box-sizing: border-box ; font-family: , &amp;#34;consolas&amp;#34; , &amp;#34;liberation mono&amp;#34; , &amp;#34;menlo&amp;#34; , monospace ; font-size: 13.6px ; padding: 0.2em 0.4em ; margin: 0px ; border-radius: 6px&quot;&gt;redisCommandTable&lt;/code&gt;&amp;nbsp;defines all the Redis commands, specifying the name of the command, the function implementing the command, the number of arguments required, and other properties of each command.&lt;/li&gt;&lt;/ul&gt;&lt;div&gt;&lt;font color=&quot;#24292e&quot;&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#24292e&quot;&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="20" y="610" width="720" height="220" as="geometry" />
        </mxCell>
        <mxCell id="fJW2ksR1hG_YBAA2tKQd-11" value="并不是所有的对象都会被包装成redisObject：&lt;br&gt;&lt;span style=&quot;color: rgb(36 , 41 , 46) ; font-family: , &amp;#34;blinkmacsystemfont&amp;#34; , &amp;#34;segoe ui&amp;#34; , &amp;#34;helvetica&amp;#34; , &amp;#34;arial&amp;#34; , sans-serif , &amp;#34;apple color emoji&amp;#34; , &amp;#34;segoe ui emoji&amp;#34; ; font-size: 16px ; background-color: rgb(255 , 255 , 255)&quot;&gt;Redis objects are used extensively in the Redis internals, however in order to avoid the overhead of indirect accesses, recently in many places we just use plain dynamic strings not wrapped inside a Redis object.&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="40" y="880" width="500" height="120" as="geometry" />
        </mxCell>
        <mxCell id="jB1BSkEtGHHW1r5DU6Ng-1" value="" style="endArrow=none;html=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="20" y="1100" as="sourcePoint" />
            <mxPoint x="760" y="1100" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="jB1BSkEtGHHW1r5DU6Ng-2" value="&lt;h1&gt;SDS&lt;/h1&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(62 , 67 , 73) ; font-family: sans-serif ; font-size: 16px ; background-color: rgb(255 , 255 , 255)&quot;&gt;Redis 没有直接使用 C 语言传统的字符串表示（以空字符结尾的字符数组，以下简称 C 字符串）， 而是自己构建了一种名为简单动态字符串（simple dynamic string，SDS）的抽象类型， 并将 SDS 用作 Redis 的默认字符串表示。&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="30" y="1140" width="650" height="120" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
